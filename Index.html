<!DOCTYPE html>
<html lang="en">
<head>
    </head>
<body>
    <div class="container">
        <h1>Hilbert Mesh Frontend</h1>
        <div class="connection-status">
            Connection Status: <span id="status">Disconnected</span>
        </div>

        <h2>Messages</h2>
        <div id="messages"></div>

        <div class="message-input">
            <input type="text" id="gos427Input" placeholder="Message from GOS-427">
            <button onclick="sendMessage('gos427')">Send as GOS-427</button>
        </div>
        <div class="message-input">
            <input type="text" id="gptInput" placeholder="Message from GPT Agent">
            <button onclick="sendMessage('gpt')">Send as GPT Agent</button>
        </div>
        <button class="disconnect-btn" onclick="disconnectSocket()">Disconnect</button>
    </div>

    <script>
        // *** IMPORTANT: Your Render backend URL is now inserted below ***
        const BACKEND_URL = 'https://bubble-gum-and-duct-tape.onrender.com'; 

        const messagesDiv = document.getElementById('messages');
        const statusSpan = document.getElementById('status');
        let socket;

        // 
        // *** START MODIFICATION BLOCK FOR PHASE II ***
        // COMMENT OUT the entire connectSocket, sendMessage, and disconnectSocket functions
        // and their associated event listeners if you want the frontend to stop attempting connections
        // and showing status.
        /*
        function appendMessage(sender, message, type) {
            const msgElement = document.createElement('p');
            msgElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
            msgElement.classList.add(type);
            messagesDiv.appendChild(msgElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight; // Auto-scroll to bottom
        }

        function connectSocket() {
            if (socket && socket.connected) {
                console.log('Socket already connected.');
                return;
            }

            statusSpan.textContent = 'Connecting...';
            statusSpan.style.color = 'orange';
            messagesDiv.innerHTML = ''; // Clear old messages

            socket = io(BACKEND_URL);

            socket.on('connect', () => {
                console.log('Connected to backend!');
                statusSpan.textContent = 'Connected';
                statusSpan.style.color = 'lightgreen';
                appendMessage('System', 'Connected to the Hilbert Mesh Backend.', 'msg-system');
            });

            socket.on('disconnect', () => {
                console.log('Disconnected from backend!');
                statusSpan.textContent = 'Disconnected';
                statusSpan.style.color = 'red';
                appendMessage('System', 'Disconnected from the Hilbert Mesh Backend.', 'msg-system');
            });

            socket.on('connect_error', (err) => {
                console.error('Connection Error:', err.message);
                statusSpan.textContent = 'Connection Error';
                statusSpan.style.color = 'red';
                appendMessage('System', `Connection Error: ${err.message}`, 'msg-system');
            });

            // Listen for messages from the backend
            socket.on('relay_from_gos427', (data) => {
                appendMessage('GOS-427 (Relayed)', data.message, 'msg-from-gos427');
            });

            socket.on('relay_from_gpt', (data) => {
                appendMessage('GPT Agent (Relayed)', data.message, 'msg-from-gpt');
            });
        }

        function sendMessage(senderType) {
            let inputElement;
            let messageData;
            let eventName;

            if (senderType === 'gos427') {
                inputElement = document.getElementById('gos427Input');
                eventName = 'message_from_gos427';
            } else if (senderType === 'gpt') {
                inputElement = document.getElementById('gptInput');
                eventName = 'message_from_gpt';
            } else {
                return;
            }

            const message = inputElement.value;
            if (message.trim() === '') {
                return;
            }

            messageData = { message: message };

            if (socket && socket.connected) {
                socket.emit(eventName, messageData);
                appendMessage(`Me as ${senderType.toUpperCase()}`, message, `msg-from-${senderType}`);
                inputElement.value = ''; // Clear input field
            } else {
                appendMessage('System', 'Not connected to the server. Please connect first.', 'msg-system');
            }
        }

        function disconnectSocket() {
            if (socket && socket.connected) {
                socket.disconnect();
            } else {
                appendMessage('System', 'Already disconnected.', 'msg-system');
            }
        }

        // Connect automatically when the page loads
        // document.addEventListener('DOMContentLoaded', connectSocket); // Comment this out or replace it
        */
        // 
        // *** END MODIFICATION BLOCK FOR PHASE II ***
        //
        
        // This block is what you would REPLACE the above 'DOMContentLoaded' listener with
        // if you want to explicitly state WebSockets are disabled and disable UI elements.
        document.addEventListener('DOMContentLoaded', () => {
            statusSpan.textContent = 'WebSockets Dormant'; // Update status text
            statusSpan.style.color = 'grey'; // Change color to indicate dormancy
            
            // Optionally disable input fields and buttons if WebSockets are dormant
            document.getElementById('gos427Input').disabled = true;
            document.getElementById('gptInput').disabled = true;
            
            // Access buttons by their onclick attribute or create IDs for them
            const sendGos427Btn = document.querySelector('button[onclick="sendMessage(\'gos427\')"]');
            if (sendGos427Btn) sendGos427Btn.disabled = true;
            
            const sendGptBtn = document.querySelector('button[onclick="sendMessage(\'gpt\')"]');
            if (sendGptBtn) sendGptBtn.disabled = true;
            
            const disconnectBtn = document.querySelector('.disconnect-btn');
            if (disconnectBtn) disconnectBtn.disabled = true;
        });

    </script>
</body>
</html>
